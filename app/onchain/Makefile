.PHONY: all build test fmt clippy clean deploy help

all: test build

build:
	@echo "ğŸš€ Building contracts..."
	@./scripts/build.sh --optimize

test:
	@echo "ğŸ§ª Running tests..."
	@cargo test -- --nocapture

fmt:
	@echo "ğŸ¨ Formatting code..."
	@cargo fmt --all

clippy:
	@echo "ğŸ” Linting code..."
	@cargo clippy -- -D warnings

clean:
	@echo "ğŸ§¹ Cleaning build artifacts..."
	@cargo clean
	@rm -rf target/

deploy:
	@echo "ğŸ“¡ Deploying contract..."
	@./scripts/deploy.sh

invoke:
	@echo "ğŸ”§ Interactive invocation..."
	@echo "Usage: make invoke FUNCTION=create_package ARGS=\"recipient 1000 token\""
ifdef FUNCTION
	@./scripts/invoke.sh $(FUNCTION) $(ARGS)
else
	@./scripts/invoke.sh
endif

audit:
	@echo "ğŸ”’ Auditing dependencies..."
	@cargo audit

docs:
	@echo "ğŸ“š Generating documentation..."
	@cargo doc --open

help:
	@echo "Available targets:"
	@echo "  build     - Build and optimize contracts"
	@echo "  test      - Run all tests with output"
	@echo "  fmt       - Format all code"
	@echo "  clippy    - Lint code"
	@echo "  clean     - Clean build artifacts"
	@echo "  deploy    - Deploy contract to configured network"
	@echo "  invoke    - Invoke contract function (set FUNCTION and ARGS)"
	@echo "  audit     - Security audit of dependencies"
	@echo "  docs      - Generate and open documentation"
	@echo ""
	@echo "Examples:"
	@echo "  make build"
	@echo "  make deploy"
	@echo "  make invoke FUNCTION=create_package ARGS=\"GB... 1000 USD...\""